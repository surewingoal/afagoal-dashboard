<!DOCTYPE html>
<html lang="zh_CN" xmlns:th="http://www.thymeleaf.org">
<meta charset="utf-8"/>
<head th:include="include :: header"></head>
<body class="gray-bg">
<div class="wrapper wrapper-content ">
    <div class="col-sm-12">
        <div class="ibox">
            <div class="ibox-body">
                <div class="fixed-table-toolbar">


                    <div class="columns pull-left col-md-2 nopadding">
                        <input id="searchName" type="text" class="form-control"
                               placeholder="关键字查询"/>
                        <input id="token_id" type="hidden" th:value="${token_id}"/>
                    </div>



                    <div class="columns pull-left col-md-8 nopadding">
                        <select id="token_select" class="selectpicker" onchange="tokenChange()"
                                data-live-search="true">
                        </select>
                    </div>

                    <div class="columns pull-right">
                        <button class="btn btn-success" onclick="reLoad()">查询</button>
                    </div>


                </div>
                <table id="exampleTable" data-mobile-responsive="true">
                </table>
            </div>
        </div>
    </div>
</div>
<div th:include="include::footer"></div>
<script>
    var prefix = "/blockchain/token_detail"
    $(document).ready(function () {
        initSelect();
        load();
    });

    function load() {
        $('#exampleTable')
                .bootstrapTable(
                        {
                            method: 'get', // 服务器数据的请求方式 get or post
                            url: prefix + "/list", // 服务器数据的加载地址
                            // showRefresh : true,
                            // showToggle : true,
                            // showColumns : true,
                            iconSize: 'outline',
//                            toolbar : '#exampleToolbar',
                            striped: true, // 设置为true会有隔行变色效果
                            dataType: "json", // 服务器返回的数据类型
                            pagination: true, // 设置为true会在底部显示分页条
                            queryParamsType: "limit",
                            // //设置为limit则会发送符合RESTFull格式的参数
                            singleSelect: false, // 设置为true将禁止多选
                            // contentType : "application/x-www-form-urlencoded",
                            // //发送到服务器的数据编码类型
                            pageSize: 10, // 如果设置了分页，每页数据条数
                            pageNumber: 1, // 如果设置了分布，首页页码
                            // search : true, // 是否显示搜索框
                            showColumns: false, // 是否显示内容下拉框（选择显示的列）
                            sidePagination: "server", // 设置在哪里进行分页，可选值为"client" 或者
                            // "server"
                            queryParams: function (params) {
                                return {
                                    // 说明：传入后台的参数包括offset开始索引，limit步长，sort排序列，order：desc或者,以及所有列的键值对
                                    size: params.limit,
                                    page: params.offset / params.limit,
                                    token_id: $("#token_id").val(),
                                    key: $('#searchName').val()
                                };
                            },
                            // //请求服务器数据时，你可以通过重写参数的方式添加一些额外的参数，例如 toolbar 中的参数 如果
                            // queryParamsType = 'limit' ,返回参数必须包含
                            // limit, offset, search, sort, order 否则, 需要包含:
                            // pageSize, pageNumber, searchText, sortName,
                            // sortOrder.
                            // 返回false将会终止请求
                            columns: [
                                {
                                    field: 'id', // 列字段名
                                    title: '序号' // 列标题
                                },
                                {
                                    field: 'tokenName',
                                    title: '币种名称'
                                },
                                {
                                    field: 'tokenCode',
                                    title: '币种编码'
                                },
                                {
                                    field: 'priceChange',
                                    title: '价格浮动'
                                },
                                {
                                    field: 'statisticTime',
                                    title: '统计时间'
                                },
                                {
                                    field: 'totalValue',
                                    title: '币种总值'
                                },
                                {
                                    field: 'usdProfitability',
                                    title: 'USD盈利率'
                                },
                                {
                                    field: 'ethProfitability',
                                    title: 'ETH盈利率'
                                },
                                {
                                    field: 'circulatingSupply',
                                    title: '今日流动量'
                                },

                                {
                                    field: 'todayTransaction',
                                    title: '今日交易量'
                                },
                                {
                                    title: '操作',
                                    field: 'id',
                                    align: 'center',
                                    formatter: function (value, row, index) {
                                        var e = '<a  class="btn btn-primary" href="#" mce_href="#" title="查看" onclick="info(\''
                                                + row.id
                                                + '\')"><i class="fa fa-edit "></i></a> ';
                                        return e;
                                    }
                                }]
                        });
    }
    function reLoad() {
        $('#exampleTable').bootstrapTable('refresh');
    }
    function info(id) {
        layer.open({
                       type: 2,
                       title: '当日详情',
                       maxmin: true,
                       shadeClose: false, // 点击遮罩关闭层
                       area: ['800px', '600px'],
                       content: prefix + '/info?id=' + id // iframe的url
                   });
    }

    function tokenChange() {
        var token_id = $("#token_select").val();
        $("#token_id").val(token_id);
    }

    function initSelect() {
        var select = $("#token_select");
        var option_value;

        $.ajax({
                   url : "/blockchain/token/simple_list",
                   type : "get",
                   success : function(dtos) {
                           $.each(dtos,function(index,dto){
                               option_value = '<option value="' + dto.id + '">' + dto.tokenName +  '</option>';
                               select.append(option_value);
                           });
                       $("#token_select").selectpicker('refresh');
                   }
               });

    }

</script>
</body>

</html>